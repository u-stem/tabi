# UX改善設計: パターン操作性・日またぎ表示・共有/印刷レイアウト

## 1. パターンアクションの操作性改善

### 課題

- `ChevronDown` ボタンが 12px (h-3 w-3) で、スマホではタップターゲットが小さすぎる
- ボタンの存在に気づきにくく、どこを押せばアクションメニューが出るか分かりづらい

### 設計

- `ChevronDown` を廃止し、`MoreHorizontal` (...) アイコンボタンに変更
- タップターゲットを最低 44x44px に拡大（Apple HIG / Material Design 推奨値）
- アイコン自体は 16px (h-4 w-4)、ボタンサイズは `h-7 w-7 sm:h-6 sm:w-6` + `flex items-center justify-center`
- ドロップダウンメニュー内容（名前変更・複製・削除）は変更なし
- メニュー内アイコンも `h-4 w-4` に統一（現状 h-3 w-3）

### 対象ファイル

- `apps/web/app/(authenticated)/trips/[id]/page.tsx` (行738-773付近)
- `apps/web/e2e/patterns.spec.ts` - セレクタ更新

## 2. 日をまたぐ予定の役割ラベル自動付与

### 課題

- 宿泊など複数日にまたがる予定で、同じ名前が2日分表示される
- チェックイン/チェックアウトなど、各日での役割が一目で分からない

### 設計

カテゴリに基づいて開始日・継続日にラベルを自動表示する。

| カテゴリ | 開始日ラベル | 継続日(最終日)ラベル | 継続日(中間日)ラベル |
|---------|------------|-------------------|-------------------|
| 宿泊 (accommodation) | チェックイン | チェックアウト | 滞在中 |
| 移動 (transport) | 既存の出発地/到着地表示を維持 | 同左 | - |
| その他全般 | 開始 | 終了 | 継続中 |

#### 表示方法

- 開始日側: 予定名の下にラベルをサブテキストとして表示
- 継続日側: 既存の「N日目から継続」バッジを役割ラベルに置換
- 破線ボーダー + 薄いグレー背景の視覚的区別は維持

#### 3日以上にまたがるケース

- 例: 3泊4日の宿泊 → 1日目「チェックイン」、2-3日目「滞在中」、4日目「チェックアウト」
- `endDayOffset` と現在の `dayNumber` の差分で中間日か最終日かを判定

### 対象ファイル

- `apps/web/components/schedule-item.tsx` - ラベル表示の追加
- `apps/web/components/day-timeline.tsx` - ラベル情報を schedule-item に渡す
- `apps/web/lib/cross-day.ts` - ラベル情報の算出ロジック追加（中間日/最終日の判定）
- `apps/web/app/shared/[token]/page.tsx` - ラベル情報の受け渡し
- `apps/web/app/(authenticated)/trips/[id]/print/page.tsx` - ラベル情報の受け渡し

## 3. PDF/印刷の表形式レイアウト

### 課題

- 現状のカード形式は余白が多く、紙面を無駄にしている
- 一覧性が低く、特定の情報を拾いにくい

### 設計

カード形式を廃止し、日ごとのテーブルレイアウトに変更する。

#### 列構成

| 時間 | 名前 | カテゴリ | 住所 | メモ |
|------|------|---------|------|------|
| 10:00 - 11:30 | 浅草寺 | 観光 | 東京都台東区... | 雷門から入る |
| 11:30 ~ | ホテルA (チェックイン) | 宿泊 | 東京都... | - |

- 日ごとにテーブルを配置（現状のセクション分けは維持）
- パターンが複数ある場合はパターン名を行グループのヘッダーとして表示
- 日をまたぐ予定は役割ラベルを名前の横に括弧付きで表示
- 継続行は破線の上ボーダーで区別
- URL は非表示（印刷で意味がないため）
- `break-inside-avoid` はテーブル行グループ単位で適用

### 対象ファイル

- `apps/web/app/(authenticated)/trips/[id]/print/page.tsx` - テーブルレイアウトへ全面書き換え

### エクスポート (Excel/CSV) との関係

- 印刷とエクスポートは別ページのまま維持
- 印刷: ブラウザ印刷ダイアログで出力、見た目・ページ分割制御が必要
- エクスポート: ファイルダウンロード、データ再利用が目的

## 4. 共有リンクのコンパクトリスト形式

### 課題

- 現状のカード形式は余白・装飾が多く、スマホで情報密度が低い
- 旅行中にさっと確認する用途に対して、スクロール量が多い

### 設計

カード形式の余白・装飾を削り、情報密度を上げたコンパクトリスト形式にする。

#### 変更点

- カード間のギャップを縮小
- カテゴリアイコン + 時刻 + 名前を1行にまとめる
- 住所・メモは小さいフォントで2行目に表示
- 日をまたぐ予定は役割ラベル付き（セクション2と同様）
- URL はタップでリンク遷移できるアイコンボタンとして表示

#### レスポンシブ

- スマホ: コンパクトリスト（1行に収まる情報量を優先）
- タブレット以上: やや余裕を持たせた表示

### 対象ファイル

- `apps/web/app/shared/[token]/page.tsx` - レイアウト調整
